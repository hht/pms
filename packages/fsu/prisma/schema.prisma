// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["interactiveTransactions"]

}

datasource db {
  provider = "sqlite"
  url      = "file:../database/pms.db?socket_timeout=10&connection_limit=1"
}

model Unit {
  id            Int       @id @default(autoincrement())
  userName      String?   @unique @default("")
  password      String?   @default("")
  unitId        String?   @default("")
  resourceId    String?   @default("")
  localAddress  String    @default("")
  remoteAddress String    @default("")
  port          Int
  model         String?   @default("")
  version       String?   @default("")
  unitVersion   String?   @default("")
  manufacturer  String?   @default("")
  interval      Int       @default(60)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime
  reportedAt    DateTime?
  heartBeat     Int       @default(6000)
  longitude     Float     @default(126.642)
  latitude      Float     @default(45.757)
}

model Alarm {
  id               Int       @id @default(autoincrement())
  deviceId         String
  deviceResourceId String
  signalId         String
  signal           String
  value            String
  description      String
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  occuredAt        DateTime  @default(now())
  clearedAt        DateTime?
  state            String?
  reported         Boolean   @default(false)
}

model Device {
  id           Int      @id @default(autoincrement())
  resourceId   String   @default("")
  code         String
  serial       String   @unique
  name         String
  controller   String   @default("")
  protocol     String   @default("")
  model        String
  productionAt DateTime @default(now())
  version      String   @default("")
  manufacturer String   @default("")
  batch        String   @default("")
  status       String   @default("工作正常")
  address      Int?     @default(1)

  port     String
  activite Boolean @default(false)
  baudRate Int     @default(9600)
  timeout  Int     @default(3000)

  createdAt DateTime  @default(now())
  updatedAt DateTime?
  signals   Signal[]
}

model Signal {
  id               String  @id @unique
  name             String
  code             String
  index            Int
  raw              Float?
  value            String
  normalValue      Int?
  unit             String? @default("")
  enum             String?
  command          String
  offset           Int
  length           Int     @default(4)
  ignore           Boolean @default(false)
  upperMinorLimit  Float?
  upperMajorLimit  Float?
  lowerMinorLimit  Float?
  lowerMajorLimit  Float?
  threshold        Float?  @default(0)
  thresholdPercent Float?  @default(0)


  startDelay Int?      @default(0)
  endDelay   Int?      @default(9)
  enabled    Boolean   @default(true)
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  reportAt   DateTime?
  interval   Int       @default(10)
  alarm      Int?

  device   Device @relation(fields: [deviceId], references: [id], onDelete: Cascade)
  deviceId Int
  @@unique([deviceId, code, index])
}

model History {
  id        Int      @id @default(autoincrement())
  payload   String
  code      Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Log {
  id          Int      @id @default(autoincrement())
  description String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now())

}
