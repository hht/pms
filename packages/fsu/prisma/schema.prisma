// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["interactiveTransactions"]

}

datasource db {
  provider = "sqlite"
  url      = "file:../database/pms.db?socket_timeout=10&connection_limit=1"
}

model Unit {
  id           Int       @id @default(autoincrement())
  userName     String?   @unique
  password     String?
  unitId       String?
  resourceId   String?
  ipAddress    String
  port         Int
  model        String?
  version      String?
  unitVersion  String?
  manufacturer String?
  interval     Int       @default(60)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  reportedAt   DateTime?

  devices Device[]

}

model Alarm {
  id          Int      @id @default(autoincrement())
  signal      String
  value       String
  description String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  active      Boolean  @default(true)
}

model Device {
  id Int @id @default(autoincrement())

  code         String
  serial       String
  name         String
  controller   String   @default("")
  protocol     String   @default("")
  model        String
  productionAt DateTime @default(now())
  version      String   @default("")
  manufacturer String   @default("")
  batch        String   @default("")

  port     String  @unique
  activite Boolean @default(false)
  baudRate Int     @default(9600)
  timeout  Int     @default(3000)

  Unit      Unit?     @relation(fields: [unitId], references: [id])
  unitId    Int?
  updatedAt DateTime?
  signals   Signal[]
}

model Signal {
  id               String  @id @unique
  name             String
  code             String
  raw              Float?
  value            String
  normalValue      Int?
  unit             String?
  command          String?
  offset           Int
  length           Int     @default(4)
  ignore           Boolean @default(false)
  upperMinorLimit  Float?
  upperMajorLimit  Float?
  lowerMinorLimit  Float?
  lowerMajorLimit  Float?
  threshold        Float?
  thresholdPercent Float?


  startDelay Int?
  endDelay   Int?
  enabled    Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt


  device   Device @relation(fields: [deviceId], references: [id])
  deviceId Int
}

model History {
  id          Int      @id @default(autoincrement())
  point       String
  value       String
  description String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
